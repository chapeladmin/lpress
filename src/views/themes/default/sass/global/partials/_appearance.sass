@mixin background_opacity($color, $opacity: 0.6, $fallback: $color)
  background: $fallback
  background: rgba($color, $opacity)

@mixin border_image($url, $height, $type, $width: $height, $htype: $type)
  -moz-border-image: url($url) $height $width $type $htype
  -webkit-border-image: url($url) $height $width $type $htype
  -o-border-image: url($url) $height $width $type $htype
  border-image: url($url) $height $width $type $htype
  background-clip: padding-box
  border-style: solid /* for firefox */

@mixin form_common($button: false, $real_button: false)
  @include background_opacity($form_input_rgba_background, 0.3, $fallback: $form_input_background)
  border: none
  outline: 2px outset $input_outline_color
  outline-offset: -2px
  color: $form_input_text
  @if $button
    cursor: pointer
    text-decoration: underline
    .button-icon
      text-decoration: none
      display: inline-block
    .icon-ok
      color: $success_color
  @if $button and $real_button
    &:active
      @include background_opacity($form_input_rgba_background, $fallback: $form_input_focused_background)
      outline: 2px inset $input_outline_color !important /* need to override focus on IE for .active class */
    &:focus
      @include background_opacity($form_input_rgba_background, $fallback: $form_input_focused_background)
  @if $button
    &:hover
      text-decoration: none
  @if $button == false
    &:focus
      @include background_opacity($form_input_rgba_background, $fallback: $form_input_focused_background)
      outline: 2px inset $input_outline_color

%real-button
  @include form_common($button: true, $real_button: true)

%faux-button
  @include form_common($button: true, $real_button: false)

%unselectable
  -webkit-touch-callout: none
  -webkit-user-select: none
  -khtml-user-select: none
  -moz-user-select: none
  -ms-user-select: none
  user-select: none

%error
  color: $error_text
  @include background_opacity($error_background, 0.3)
  border: 1px solid $error_border

body
  color: $text_color
  background: url(#{$base_path}/images/backgrounds/body.png?v1)

a
  color: $link_color
  &:hover
    text-decoration: none

.nojs a.file
  display: none !important

h1, h2, h3
  color: $heading_color

td
  @include background_opacity($td_rgba_background, 0.2, $td_background)
  border: 4px solid $td_border_color

tr:hover
  td
    @include background_opacity($td_rgba_background, 0.4, $td_background)
  td.editable:hover
    color: $link_color

#page
  background: url(#{$base_path}/images/backgrounds/page.png?v1)
  border-width: 0 3px 0 3px
  border-style: double

.button-icon
  text-shadow: 0px 0px 2px $text_color, 0px 0px 2px $text_color

.colorbox
  display: none

#colorbox
  .colorbox
    display: block
  #cboxContent
    background: url(#{$base_path}/images/backgrounds/body.png?v1)
  .tabs
    background: url(#{$base_path}/images/backgrounds/page.png?v1)
  ul.etabs
    background: url(#{$base_path}/images/backgrounds/body.png?v1)
    a.active
      background: url(#{$base_path}/images/backgrounds/page.png?v1)
      text-decoration: none
      color: $text_color
      cursor: default

.borderimage #page
  $border_width: 15
  border-width: 0 #{$border_width}px 0 #{$border_width}px
  $url: "#{$base_path}/images/borders/page.png?v1"
  @include border_image($url, $height: 0, $width: $border_width, $type: repeat)

.error
  @extend %error

.message
  color: $message_text
  @include background_opacity($message_background, 0.3)
  border: 1px solid $message_border

.text input, textarea
  @include form_common()

.lt-ie8
  input, textarea, span.faux-checkbox, span.button, a.button
    border: 2px outset $input_outline_color
  input.focused, textarea.focused
    border: 2px inset $input_outline_color
    @include background_opacity($form_input_rgba_background, $fallback: $form_input_focused_background)
  span.focused-button, a.focused-button
    @include background_opacity($form_input_rgba_background, $fallback: $form_input_focused_background)
  span.active-button, a.active-button
    border: 2px inset $input_outline_color
    @include background_opacity($form_input_rgba_background, $fallback: $form_input_focused_background)
  input.file
    background: $form_input_background

label.checkbox
  @extend %unselectable
  cursor: pointer
  &:hover
    @include background_opacity($checkbox_hover_rgba_background, 0.2, $checkbox_hover_background)
  span.checkmark
    @extend %unselectable
    visibility: hidden

.js label.checkbox
  input.checkbox
    &:focus + span.faux-checkbox
      @extend %real-button:focus
    &:active + span.faux-checkbox
      @extend %real-button:focus
  span.faux-checkbox
    @extend %faux-button
  span.focused-checkbox
    @extend %real-button:focus
  span.active-checkbox
    @extend %real-button:active

.opacity div.upload, .ie div.upload
  input.file
    cursor: pointer
    opacity: 0
    &:active + span.button /* for mouse */
      @extend %real-button:active
    &:focus + span.button /* for mouse */
      @extend %real-button:focus

span.button, a.button
  @extend %unselectable
  @extend %faux-button

.js
  label.checked span.faux-checkbox span.checkmark
    visibility: visible
  span.active-button, a.active-button
    @extend %real-button:active
  span.focused-button, a.focused-button
    @extend %real-button:focus

input.button, button
  @extend %real-button

input.file:hover + a.button,
input.file:hover + span.button
  text-decoration: none

#gallery, .files
  list-style: none
  a
    @include background_opacity($gallery_item_background, 0.3)
    &:hover
      @include background_opacity($gallery_item_hover_background, 0.3)
  span.caption
    @include background_opacity($gallery_item_background, 0.8)

.lt-ie7
  #gallery, .files
    li
      .caption
        cursor: pointer

ul.dropzone
  cursor: pointer

a.dz-preview
  div.dz-progress
    @include background_opacity($gallery_item_background, 0.8)
  span.dz-upload
    background-color: $success_color
  div.dz-success-mark
    color: $success_color
  div.dz-error-message
    @extend %error

a.dz-error
  &:hover
    @include background_opacity($gallery_item_background, 0.3)
  cursor: default !important
  *
    cursor: default !important
