@mixin background_opacity($color, $opacity: 0.6)
  background: $color /* The Fallback */
  background: rgba($color, $opacity)

@mixin border_image($url, $height, $type, $width: $height, $htype: $type)
  -moz-border-image: url($url) $height $width $type $htype
  -webkit-border-image: url($url) $height $width $type $htype
  -o-border-image: url($url) $height $width $type $htype
  border-image: url($url) $height $width $type $htype
  background-clip: padding-box
  border-style: solid /* for firefox */

@mixin form_common($background_color, $outline_color, $color, $button: false)
  @include background_opacity($background_color, 0.3)
  border: none
  outline: 2px outset $outline_color
  outline-offset: -2px
  color: $color
  @if $button
    &:active
      @include background_opacity($background_color)
      outline: 2px inset $outline_color !important /* need to override focus on IE for .active class */
    &:focus
      @include background_opacity($background_color)
      outline: 2px outset $outline_color
  @else
    &:focus
      @include background_opacity($background_color)
      outline: 2px inset $outline_color

%button
  @include form_common($form_input_background, $input_outline_color, $form_input_text, true)

body
  color: $text_color
  background: url(#{$base_path}/images/backgrounds/body.png?v=1)

a
  color: $link_color
  &:hover
    text-decoration: none

h1
  color: $heading_color

#page
  background: url(#{$base_path}/images/backgrounds/page.png?v=1)
  border-width: 0 3px 0 3px
  border-style: double 

.borderimage #page
  $border_width: 15
  border-width: 0 #{$border_width}px 0 #{$border_width}px
  $url: "#{$base_path}/images/borders/page.png?v=1"
  @include border_image($url, $height: 0, $width: $border_width, $type: repeat)

.error
  color: $error_text
  @include background_opacity($error_background, 0.3)
  border: 1px solid $error_border

.message
  color: $message_text
  @include background_opacity($message_background, 0.3)
  border: 1px solid $message_border

.text input, textarea
  @include form_common($form_input_background, $input_outline_color, $form_input_text)

.lt-ie8 input, textarea
  border: 1px solid $text_color !important

.lt-ie8 input.file
  background: $form_input_background !important

label.checkbox
  cursor: pointer
  -webkit-touch-callout: none
  -webkit-user-select: none
  -khtml-user-select: none
  -moz-user-select: none
  -ms-user-select: none
  user-select: none
  &:hover
    @include background_opacity($checkbox_hover_background, 0.2)
  span.checkmark
    visibility: hidden

.opacity label.checkbox
  input.real-checkbox
    cursor: pointer
    opacity: 0 /* visibility: hidden disables focusability */
    &:focus + span.faux-checkbox
      @extend %button:focus
    &:active + span.faux-checkbox
      @extend %button:focus
  span.focused
    @extend %button:focus
  span.faux-checkbox
    @extend %button

.opacity label.checked span.faux-checkbox span.checkmark
  visibility: visible

.opacity div.file 
  input.file
    cursor: pointer 
    opacity: 0
    &:active + input.faux-file /* for mouse */
      @extend %button:active
    &:focus + input.faux-file /* for mouse */
      @extend %button:focus
  p.file
    display: inline-block

.ie input.file
  opacity: 1 !important

input.active-button
  @extend %button:active

input.button
  @extend %button
